<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Catálogo — Miyotl Products</title>
  <meta name="description" content="Catálogo de jabones artesanales de glicerina. Filtra por piel sensible, exfoliantes, astringentes o aromáticos.">
  <style>
    :root{
      --brand-50:#F7EFE6; --brand-100:#F2E6D8; --brand-200:#EAD6C0; --brand-300:#DBBFA2;
      --brand-400:#C9A781; --brand-500:#2B0F3A; --brand-700:#1B0D28;
      --miyotl:#C53D8C; --ink:#140A1F;
    }
    *{box-sizing:border-box} body{margin:0;font-family:ui-sans-serif,system-ui,Inter,Segoe UI,Roboto,Arial;color:var(--ink);background:#fff}
    .container{max-width:1120px;margin:0 auto;padding:0 16px}

    /* Banner */
    header{background:#e1d1bd}
    .top-banner{width:100%;height:260px;object-fit:cover;display:block;filter:saturate(0.9)}
    .headline{position:relative}
    .headline h1{
      position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
      margin:0;color:#fff;background:rgba(0,0,0,.35);padding:8px 14px;border-radius:12px;
      font-weight:900;letter-spacing:.3px
    }

    /* Filtros */
    .filters{display:flex;gap:10px;justify-content:center;align-items:center;flex-wrap:wrap;
      padding:12px 16px;border-bottom:1px solid var(--brand-200);background:#fff}
    .filters button{
      appearance:none;border:1px solid #A83477;background:var(--miyotl);color:#fff;cursor:pointer;
      padding:8px 12px;border-radius:12px;font-weight:700;font-size:14px;transition:.15s transform,.15s opacity
    }
    .filters button:hover{transform:translateY(-1px)}
    .filters button.is-active{box-shadow:0 2px 10px rgba(0,0,0,.12)}
    .note{font-size:13px;color:#4d4d4d;text-align:center;margin:8px 0 18px}

    /* Grid: 4 por línea en desktop */
    .grid{display:grid;gap:18px}
    @media(min-width:768px){.grid{grid-template-columns:repeat(4,minmax(0,1fr))}}
    .card{
      background:#fff;border:1px solid var(--brand-200);border-radius:18px;overflow:hidden;
      box-shadow:0 4px 14px rgba(0,0,0,.06);transition:.15s transform,.15s border-color;cursor:pointer
    }
    .card:hover{transform:translateY(-3px);border-color:var(--brand-400)}
    .card img{width:100%;aspect-ratio:3/4;object-fit:cover;display:block}
    .card h3{font-size:16px;margin:10px 12px 2px}
    .tagline{color:#555;margin:0 12px 12px;font-size:13px;min-height:34px}

    /* Modal genérico */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.38);padding:20px;z-index:1000}
    .modal.open{display:flex}
    .sheet{
      background:#fff;max-width:720px;width:min(92vw,720px);border-radius:16px;padding:16px;box-shadow:0 10px 40px rgba(0,0,0,.25)
    }
    .sheet header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;background:none}
    .sheet .media{display:grid;gap:12px;grid-template-columns:160px 1fr}
    .sheet .media img{width:100%;border-radius:12px}
    .btn{
      appearance:none;border:0;border-radius:12px;padding:10px 14px;font-weight:800;cursor:pointer;color:#fff;background:var(--miyotl)
    }
    .btn.secondary{background:#fff;color:var(--ink);border:1px solid var(--brand-300)}
    .muted{color:#4d4d4d}
    .danger{color:#b42318;font-weight:700}

    /* Modal Sign-in */
    .stack{display:grid;gap:10px}
    input[type="email"],input[type="password"]{width:100%;padding:10px;border-radius:10px;border:1px solid var(--brand-300)}
    .center{text-align:center}
    footer{padding:18px 0 28px;border-top:1px solid var(--brand-100);margin-top:28px}
  </style>
</head>
<body>

<header class="headline">
  <!-- Usa otra imagen para diferenciar del home -->
  <img class="top-banner" src="Assets/Images/catalogo-banner.webp">
 </header>

<!-- Filtros -->
<div class="filters">
  <button data-filter="all" class="is-active">Todos</button>
  <button data-filter="sensible">Piel sensible</button>
  <button data-filter="exfoliante">Exfoliantes</button>
  <button data-filter="astringente">Astringentes</button>
  <button data-filter="aromatico">Aromáticos</button>
</div>
<p class="note">Haz clic en cualquier producto para ver sus beneficios. Elije lo que tu piel necesita.</p>

<main class="container">
  <!-- Grid de productos -->
  <section id="grid" class="grid"></section>
</main>

<footer>
  <div class="container center">
    © <span id="year"></span> Miyotl Products · Hecho en México
  </div>
</footer>

<!-- Modal Producto (beneficios) -->
<div id="modalProd" class="modal" role="dialog" aria-modal="true">
  <div class="sheet">
    <header>
      <h3 id="mp-title" style="margin:0"></h3>
      <button id="mp-close" class="btn secondary">Cerrar</button>
    </header>
    <div class="media">
      <img id="mp-img" alt="">
      <div>
        <p id="mp-benefits" class="muted" style="margin-top:0"></p>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:8px">
          <button id="btn-order" class="btn">Hacer pedido</button>
          <span id="mp-tags" class="muted"></span>
        </div>
        <p class="muted" style="margin-top:12px">*Recuerda probar primero en una zona pequeña si tu piel es muy reactiva.</p>
      </div>
    </div>
  </div>
</div>

<!-- Modal Sign-in (si no ha iniciado sesión) -->
<div id="modalAuth" class="modal" role="dialog" aria-modal="true">
  <div class="sheet">
    <header><h3 style="margin:0">Inicia sesión para continuar</h3><button id="ma-close" class="btn secondary">Cerrar</button></header>
    <div class="stack">
      <input id="email" type="email" placeholder="tu@correo.com">
      <input id="pass" type="password" placeholder="••••••••">
      <button id="login" class="btn">Entrar</button>
      <p class="muted center">¿Aún no tienes cuenta? <a href="/registro">Regístrate</a></p>
    </div>
  </div>
</div>

<script>
/* =======================
   Render de grid y filtros
   ======================= */
const grid = document.getElementById('grid');
const btns = document.querySelectorAll('.filters button');
let currentFilter = 'all';
let PRODUCTS = []; // safeguard: initial empty dataset so first render() doesn't crash

function productCard(p){
  const el = document.createElement('article');
  el.className = 'card';
  el.dataset.cats = p.cats.join(',');
  el.innerHTML = `
    <img src="${p.img}" alt="${p.nombre}">
    <h3>${p.nombre}</h3>
    <p class="tagline">${p.beneficios[0] ?? ''}</p>
  `;
  el.onclick = ()=>openProduct(p);
  return el;
}
function render(filter='all'){
  const DATA = (window.PRODUCTS && Array.isArray(window.PRODUCTS)) ? window.PRODUCTS : PRODUCTS;
  grid.innerHTML = '';
  DATA.filter(p => filter==='all' || p.cats.includes(filter))
      .forEach(p => grid.appendChild(productCard(p)));
}
btns.forEach(b=>{
  b.onclick = ()=>{
    btns.forEach(x=>x.classList.remove('is-active'));
    b.classList.add('is-active');
    currentFilter = b.dataset.filter;
    render(currentFilter);
  }
});

render();

/* =======================
   Modal de producto
   ======================= */
const modalProd = document.getElementById('modalProd');
const mpClose = document.getElementById('mp-close');
const mpTitle = document.getElementById('mp-title');
const mpImg = document.getElementById('mp-img');
const mpBenefits = document.getElementById('mp-benefits');
const mpTags = document.getElementById('mp-tags');
const btnOrder = document.getElementById('btn-order');

function openProduct(p){
  mpTitle.textContent = p.nombre;
  mpImg.src = p.img; mpImg.alt = p.nombre;
  mpBenefits.innerHTML = '<ul style="margin:0 0 6px 18px">' + p.beneficios.map(b=>`<li>${b}</li>`).join('') + '</ul>';
  mpTags.textContent = p.tags?.join(' · ') || '';
  modalProd.classList.add('open');
  btnOrder.onclick = onOrder;
}
mpClose.onclick = ()=>modalProd.classList.remove('open');

/* =======================
   Pedido: sign-in -> cotizador
   ======================= */
let isSignedIn = false; // CAMBIA a true cuando integres tu auth real

const modalAuth = document.getElementById('modalAuth');
document.getElementById('ma-close').onclick = ()=>modalAuth.classList.remove('open');
document.getElementById('login').onclick = ()=>{
  // Demo: marca sesión iniciada
  isSignedIn = true;
  modalAuth.classList.remove('open');
  goToQuote();
};

function onOrder(){
  if(!isSignedIn){
    modalAuth.classList.add('open'); // pide login
  }else{
    goToQuote();
  }
}
function goToQuote(){
  // Redirige al home/Index y abre el cotizador automáticamente
  window.location.href = '../Index.html?open=cotizador';
}

document.getElementById('year').textContent = new Date().getFullYear();
</script>

<!-- ===============
     Carga dinámica desde catalogo.json (sin borrar nada)
     =============== -->
<script>
(function(){
  const hasGrid = document.getElementById('grid');
  if(!hasGrid) return;

  const mapCat = (s)=>{
    if(!s) return '';
    s = (''+s).toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'');
    if(s.includes('sensible')) return 'sensible';
    if(s.includes('exfol')) return 'exfoliante';
    if(s.includes('astring')) return 'astringente';
    if(s.includes('aromatic')) return 'aromatico';
    return s;
  };

  const toArray = (v)=>{
    if(Array.isArray(v)) return v.filter(Boolean);
    if(typeof v==='string'){
      if(v.indexOf('|||')>=0) return v.split('|||').map(x=>x.trim()).filter(Boolean);
      if(v.indexOf(',')>=0) return v.split(',').map(x=>x.trim()).filter(Boolean);
      return v.trim()? [v.trim()] : [];
    }
    return [];
  };

  fetch('./catalogo.json',{cache:'no-store'})
    .then(r=>r.json())
    .then(data=>{
      const fromJSON = data.map(row=>{
        const cats = toArray(row.cats).map(mapCat).filter(Boolean);
        const beneficios = toArray(row.beneficios);
        const tags = toArray(row.tags);
        return {
          id: row.id || '',
          nombre: row.nombre || 'Producto',
          img: row.img || '../Assets/Images/placeholder.webp',
          cats,
          beneficios,
          tags,
          forma: row.forma || '',
          tamano: row.tamano || '',
          notaAdvertencia: row.notaAdvertencia || '',
          familia: row.familia || ''
        };
      });
      window.PRODUCTS = fromJSON;
      if(typeof render==='function'){
        const active = document.querySelector('.filters button.is-active');
        const f = active ? active.dataset.filter : 'all';
        render(f || 'all');
      }
    })
    .catch(err=>console.error('Error cargando catalogo.json', err));
})();
</script>
</body>
</html>
